# RPM Spec file for connectcap

Name:      @PACKAGE_NAME@
Version:   @PACKAGE_VERSION@
Release:   1%{?dist}
Summary:   Https connect proxy that captures outgoing network traffic
License:   Apache-2.0

URL:       https://github.com/minfrin/%{name}
Source0:   %{URL}/releases/download/%{name}-%{version}/%{name}-%{version}.tar.gz
BuildRequires: clang
BuildRequires: autoconf
BuildRequires: automake
BuildRequires: libtool
BuildRequires: systemd
BuildRequires: pkgconfig(apr-1)
BuildRequires: pkgconfig(apr-util-1)
BuildRequires: pkgconfig(libcrypto)
BuildRequires: pkgconfig(libpcap)

%description
The connectcap daemon is an https CONNECT proxy that records all outgoing
connections for further analysis. Use this to debug connecion issues where
the people doing the troubleshooting and the place where the trouble is
occurring are not the same place.

%prep
%setup -q

%build
%configure --sysconfdir=%{_sysconfdir} --localstatedir=%{_localstatedir}
%make_build

%install
%make_install

%pre
getent group connectcap >/dev/null || groupadd -r connectcap

%post
%systemd_post %{name}.service

%preun
%systemd_preun %{name}.service

%postun
%systemd_postun_with_restart %{name}.service

%files
%{_sbindir}/connectcap
%{_mandir}/man1/connectcap.1*
%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/%{name}/ccpasswd
%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/%{name}
%attr(2750,root,connectcap) %{_localstatedir}/spool/%{name}
%{_unitdir}/%{name}.service

%doc AUTHORS ChangeLog
%license COPYING

%changelog
* Tue Sep 30 2025 Graham Leggett <minfrin@sharp.fm> 1.0.0-1
- Initial release

